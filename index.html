<html>
<head>
	<title>Order search</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="./order.css">
</head>

<body>

<div class="container">

  <ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#upload-div">Upload CSV</a></li>
    <li><a data-toggle="tab" href="#search-div">Search</a></li>
  </ul>

  <div class="tab-content">  
		<div id="upload-div" class="tab-pane fade in active">
			<br />
			<table>
			<tr>
				<td>
					<h3>Enter the CSV data in following textarea</h3>
					<textarea id="csv-text" style="width:400;height:200"></textarea>	
					<br /><br />
					<input type="button" onclick="javascript:upload_csv_data();" value="POST CSV data"/>
					<br />
					<br />
				</td>
				<td style="border-left:1px solid #CCCCCC"> </td>
				<td>
					<h3>Upload the CSV file</h3>
					<form action="javascript:upload_csv_file()" enctype="multipart/form-data" method="post">
						<input type="file" name="file" id="file"><br /><br />
						<input type="submit" value="Upload">
					</form>
				</td>
			</tr>
			</table>
		</div>

		<div id="search-div" class="tab-pane fade">
			
			<table>
				<tr>
					<td>Object Type</td>
					<td>Object ID</td>
					<td>Timestamp</td>
				</tr>
				<tr>
					<td><input type="text" id="object-type" /></td>
					<td><input type="text" id="object-id" /></td>
					<td><input type="text" id="timestamp" /></td>
				</tr>
			</table>
			<input type="button" onclick="javascript:search_in_db();" value="Search" />
			<div id="object-status"></div>
		</div>
	</div>
</div>	
	
<script type="text/javascript">
	function upload_csv_file()
	{
		var blobFile = $('#file')[0].files[0];
		var formData = new FormData();
		formData.append("fileToUpload", blobFile);
		
		var url = "http://ec2-54-202-82-15.us-west-2.compute.amazonaws.com:80/uploadCSVFile";
		$.ajax({
		  url: url,
		  type:'post',
		  processData: false,
		  contentType: false,
		  data: formData,
		  success: function(data) {
			document.getElementById('upload-div').innerHTML = "<h2>The CSV data has been successfully uploaded!</h2>";
		  },
		  error: function() {
			document.getElementById('upload-div').innerHTML = document.getElementById('').innerHTML + "<h2>Failed to upload the data!</h2>";
		  }
	    });
	}
	
	function upload_csv_data()
	{
		var txt = document.getElementById('csv-text').value;
		txt = txt.replace(/\[/g, "(").replace(/\]/g, ")");
		
		var url = "http://ec2-54-202-82-15.us-west-2.compute.amazonaws.com:80/uploadCSVData";
		$.ajax({
		  url: url,
		  type:'post',
		  data: txt ,
		  success: function(data) {
			document.getElementById('upload-div').innerHTML = "<h2>The CSV data has been successfully uploaded!</h2>";
		  },
		  error: function() {
			document.getElementById('upload-div').innerHTML = document.getElementById('').innerHTML + "<h2>Failed to upload the data!</h2>";
		  }
	    });
   	}
	
	function search_in_db()
	{
		var id = document.getElementById('object-id').value;
		var type = document.getElementById('object-type').value;
		var timestamp = document.getElementById('timestamp').value;
		
		var url = "http://ec2-54-202-82-15.us-west-2.compute.amazonaws.com:80/search?id=" + id + "&type=" + type + "&timestamp=" + timestamp;
		$.ajax({
		  url: url,
		  type:'get',
		  success: function(data) {
		  
			if(data.output != "")
			{
				var tmp = data.output.substring(1, data.output.length-2);
				tmp = tmp.replace(/\'/g, "\"");
				var output = JSON.stringify(JSON.parse(tmp), null, 2);
				document.getElementById('object-status').innerHTML = "<br /> The object state is : <br /><textarea>" + output + " </textarea>";
			}
			else
			{
				document.getElementById('object-status').innerHTML = "<h4>The object does not exist at given timestamp</h3>";
			}
			//console.log(data);
		  },
		  error: function() {

		  }
	    });
	}

</script>	
</body>
</html>